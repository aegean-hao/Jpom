(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{563:function(s,a,r){"use strict";r.r(a);var t=r(31),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("p"),r("div",{staticClass:"table-of-contents"},[r("ul",[r("li",[r("a",{attrs:{href:"#前言"}},[s._v("前言")]),r("ul",[r("li",[r("a",{attrs:{href:"#问-升级到-2-9-x-为什么要特殊处理"}},[s._v("问：升级到 2.9.x 为什么要特殊处理？")])]),r("li",[r("a",{attrs:{href:"#问-该漏洞出现了一段时间-为什么现在才发修复版"}},[s._v("问：该漏洞出现了一段时间，为什么现在才发修复版？")])])])]),r("li",[r("a",{attrs:{href:"#升级流程总览"}},[s._v("升级流程总览")])]),r("li",[r("a",{attrs:{href:"#相关问题说明"}},[s._v("相关问题说明")]),r("ul",[r("li",[r("a",{attrs:{href:"#问-必须先升级到-2-8-24"}},[s._v("问：必须先升级到 2.8.24+？")])]),r("li",[r("a",{attrs:{href:"#问-如何查看备份记录中的备份文件路径"}},[s._v("问：如何查看备份记录中的备份文件路径？")])]),r("li",[r("a",{attrs:{href:"#问-执行-sh-xxxx-server-sh-restart-backup-h2-不生效该怎么办"}},[s._v("问：执行 sh /xxxx/Server.sh restart --backup-h2 不生效该怎么办？")])]),r("li",[r("a",{attrs:{href:"#问-官方是不是忘记还用-windows-用户啦"}},[s._v("问：官方是不是忘记还用 windows 用户啦？")])]),r("li",[r("a",{attrs:{href:"#问-不想通过管理脚本来操作-还有其他方法吗"}},[s._v("问：不想通过管理脚本来操作，还有其他方法吗？")])]),r("li",[r("a",{attrs:{href:"#问-容器安装的应该如何升级"}},[s._v("问：容器安装的应该如何升级？")])]),r("li",[r("a",{attrs:{href:"#问-升级服务端后需要将插件端也升级到-2-9-0-吗"}},[s._v("问：升级服务端后需要将插件端也升级到 2.9.0 吗？")])])])])])]),r("p"),s._v(" "),r("h2",{attrs:{id:"前言"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),r("h3",{attrs:{id:"问-升级到-2-9-x-为什么要特殊处理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-升级到-2-9-x-为什么要特殊处理"}},[s._v("#")]),s._v(" 问：升级到 2.9.x 为什么要特殊处理？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v(" ：因为 H2 在 "),r("code",[s._v("1.4.198, 2.0.202")]),s._v(" 版本间存在漏洞，漏洞编号为："),r("code",[s._v("CVE-2021-23463")]),s._v("，所以需要尽快升级到最新版本来避免该漏洞。\n但是 H2 的 1.4.x 升级到 2.0.x 是不兼容版本升级，不能直接无感升级。必须迁移旧数据到新版本中")]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"问-该漏洞出现了一段时间-为什么现在才发修复版"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-该漏洞出现了一段时间-为什么现在才发修复版"}},[s._v("#")]),s._v(" 问：该漏洞出现了一段时间，为什么现在才发修复版？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：当我们看到漏洞相关消息就开始准备方案，我们刚开始想的方案是如何避免过多的人为操作，尽量自动化完成。\n结果我们尝试发现没有办法很好的避免（准备出一个界面化的操作），最后采用命令行方式操作。（此处自动🐶）")]),s._v(" "),r("h2",{attrs:{id:"升级流程总览"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#升级流程总览"}},[s._v("#")]),s._v(" 升级流程总览")]),s._v(" "),r("ol",[r("li",[s._v("建议先升级到 2.8.24+\n"),r("ol",[r("li",[s._v("升级方法有：在线升级、手动上传 jar 包等方式升级")])])]),s._v(" "),r("li",[s._v("通过命令行的方式创建数据备份\n"),r("ol",[r("li",[s._v("启动程序参数里面添加 --backup-h2")]),s._v(" "),r("li",[s._v("linux 环境举例："),r("code",[s._v("sh /xxxx/Server.sh restart --backup-h2")])]),s._v(" "),r("li",[s._v("当控制台输出 "),r("code",[s._v("Complete the backup database, save the path as /xxx/xxx/db/backup/xxxx.sql")]),s._v(" 字样表示备份成功")])])]),s._v(" "),r("li",[s._v("手动替换 jar\n"),r("ol",[r("li",[s._v("将 lib 目录下面的 "),r("code",[s._v("Server-2.8.x.jar")]),s._v(" 替换为最新的 "),r("code",[s._v("Server-2.9.x.jar")])]),s._v(" "),r("li",[s._v("注意可能需要修改 "),r("code",[s._v("Server.sh")]),s._v(" 脚本里面的 "),r("code",[s._v("RUNJAR")]),s._v(" 变量值为您上传新 jar 的文件名，如："),r("code",[s._v("Server-2.9.x.jar")])])])]),s._v(" "),r("li",[s._v("通过指定 sql 文件方式启动\n"),r("ol",[r("li",[s._v("启动程序参数里面添加 "),r("code",[s._v("--replace-import-h2-sql=/xxxx.sql --transform-sql")]),s._v(" (路径需要替换为第二步控制台输出的 sql 文件保存路径)")]),s._v(" "),r("li",[s._v("linux 环境举例："),r("code",[s._v("sh /xxxx/Server.sh restart --replace-import-h2-sql=/xxxx.sql --transform-sql")])])])]),s._v(" "),r("li",[s._v("观察控制输出内容\n"),r("ol",[r("li",[s._v("当控制台输出 "),r("code",[s._v("Import successfully according to sql,/xxx/xxx/db/backup/xxxx.sql")]),s._v(" 字样表示升级成功并自动启动程序")]),s._v(" "),r("li",[s._v("如果出现异常信息可以先尝试在搜索引擎搜索看看是否有解决办法")]),s._v(" "),r("li",[s._v("联系官方协助排查")])])]),s._v(" "),r("li",[s._v("愉快的使用 Jpom 2.9.x")])]),s._v(" "),r("h2",{attrs:{id:"相关问题说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#相关问题说明"}},[s._v("#")]),s._v(" 相关问题说明")]),s._v(" "),r("h3",{attrs:{id:"问-必须先升级到-2-8-24"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-必须先升级到-2-8-24"}},[s._v("#")]),s._v(" 问：必须先升级到 2.8.24+？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：非必须，因为 2.8.24+ 新增了命令行方式备份数据，这样在程序未启动前就将所有数据备份导出为 sql 保证导出的数据是最新并且完整的。\n如果您不想升级到 2.8.24+ 再升级到 2.9.x 那么可以先用管理身份登录进入系统进入：【系统管理 -> 数据库备份】页面里面去创建一个全量备份记住备份文件完成路径")]),s._v(" "),r("p",[r("strong",[s._v("注意")]),s._v("："),r("code",[s._v("不通过命令行备份不能保证导出的备份数据一定是最新的奥，因为程序在运行中随时会产生新数据或者数据更新情况")])]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"问-如何查看备份记录中的备份文件路径"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-如何查看备份记录中的备份文件路径"}},[s._v("#")]),s._v(" 问：如何查看备份记录中的备份文件路径？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：备份列表中状态列后面有一个复制按钮，点击一下就复制到粘贴板啦")]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"问-执行-sh-xxxx-server-sh-restart-backup-h2-不生效该怎么办"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-执行-sh-xxxx-server-sh-restart-backup-h2-不生效该怎么办"}},[s._v("#")]),s._v(" 问：执行 "),r("code",[s._v("sh /xxxx/Server.sh restart --backup-h2")]),s._v(" 不生效该怎么办？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：如果你是从很早就使用了 Jpom 那么你现在管理服务端当脚本不是最新当，最新的管理脚本里面将执行命令的其他参数也传入了启动程序里面")]),s._v(" "),r("p",[s._v("解决办法有：")]),s._v(" "),r("ol",[r("li",[s._v("替换为最新的管理脚本文件 "),r("a",{attrs:{href:"https://gitee.com/dromara/Jpom/blob/master/modules/server/script/Server.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Server.sh"),r("OutboundLink")],1)]),s._v(" "),r("li",[s._v("手动修改管理脚本，在脚本中 "),r("code",[s._v("ARGS")]),s._v(" 变量最后添加一个 "),r("code",[s._v("$@")]),s._v(" 即可\n"),r("ol",[r("li",[s._v("完整示例："),r("code",[s._v('ARGS="--jpom.applicationTag=${Tag} --spring.profiles.active=pro --server.port=2122 --jpom.log=${Path}log $@"')])])])])]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"问-官方是不是忘记还用-windows-用户啦"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-官方是不是忘记还用-windows-用户啦"}},[s._v("#")]),s._v(" 问：官方是不是忘记还用 windows 用户啦？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：没有的，因为 linux 用户偏多，所以拿 linux 举例。windows 处理办法类似")]),s._v(" "),r("p",[s._v("可以按照 "),r("a",{attrs:{href:"https://gitee.com/dromara/Jpom/blob/master/modules/server/script/Server.bat",target:"_blank",rel:"noopener noreferrer"}},[s._v("Server.bat"),r("OutboundLink")],1),s._v(" 中 if 判断继续扩展")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" /p "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ID")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" call:start\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v(" call:stop\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v(" call:status\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),s._v(" call:restart\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5"')]),s._v(" call:use\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6"')]),s._v(" call:restart --rest:ip_config\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),s._v(" call:restart --rest:load_init_db\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8"')]),s._v(" call:restart --rest:super_user_pwd\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" EXIT\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("p",[s._v("思路添加 IF,比如：")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" /p "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ID")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" call:start\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v(" call:stop\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v(" call:status\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),s._v(" call:restart\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5"')]),s._v(" call:use\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6"')]),s._v(" call:restart --rest:ip_config\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),s._v(" call:restart --rest:load_init_db\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8"')]),s._v(" call:restart --rest:super_user_pwd\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9"')]),s._v(" call:restart --backup-h2\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10"')]),s._v(" call:restart --replace-import-h2-sql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/xxxx.sql --transform-sql\nIF "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!ID!"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(" EXIT\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("p",[r("code",[s._v("注意要修改 sql 路径")])]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"问-不想通过管理脚本来操作-还有其他方法吗"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-不想通过管理脚本来操作-还有其他方法吗"}},[s._v("#")]),s._v(" 问：不想通过管理脚本来操作，还有其他方法吗？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：有")]),s._v(" "),r("ol",[r("li",[s._v("备份数据")])]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("java -jar server-2.8.24.jar --spring.profiles.active"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pro --backup-h2\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ol",{attrs:{start:"2"}},[r("li",[s._v("导入数据")])]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("java -jar server-2.9.0.jar --spring.profiles.active"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pro --replace-import-h2-sql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/xxxx.sql --transform-sql\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ol",{attrs:{start:"3"}},[r("li",[s._v("更新管理脚本中的："),r("code",[s._v("RUNJAR")]),s._v(" 变量值为："),r("code",[s._v("server-2.9.0.jar")])])]),s._v(" "),r("p",[r("strong",[s._v("注意")]),s._v("：")]),s._v(" "),r("ol",[r("li",[s._v("通过次方式一定要在原目录操作")]),s._v(" "),r("li",[s._v("操作顺序一定是要先使用旧包备份数据，再通过新包导入数据")])]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"问-容器安装的应该如何升级"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-容器安装的应该如何升级"}},[s._v("#")]),s._v(" 问：容器安装的应该如何升级？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：升级流程和 linux 流程一致，需要注意的就是上传文件的方式需要先上传到宿主机，再通过 "),r("code",[s._v("docker cp")]),s._v(" 方式将文件复制到容器中")]),s._v(" "),r("p",[s._v("举例：")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker cp 本地文件路径 容器ID/容器NAME:容器内路径")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /roo/Server-2.9.0.jar jpom-server:/usr/local/jpom-server/lib/Server-2.9.0.jar\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"问-升级服务端后需要将插件端也升级到-2-9-0-吗"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问-升级服务端后需要将插件端也升级到-2-9-0-吗"}},[s._v("#")]),s._v(" 问：升级服务端后需要将插件端也升级到 2.9.0 吗？")]),s._v(" "),r("p",[r("strong",[s._v("答")]),s._v("：我们建议服务端和插件端的版本一致，可以同步升级到 2.9.0。")]),s._v(" "),r("p",[s._v("只要您在使用过程中没有发现部分功能异常，无法使用，接口 404 等情况下，插件端不及时更新也是没有太多问题的。")]),s._v(" "),r("p",[s._v("插件端和服务端版本差异请尽量一致或者缩写，避免出现部分功能调整后关联影响。")])])}),[],!1,null,null,null);a.default=e.exports}}]);