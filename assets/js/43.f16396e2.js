(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{537:function(s,a,t){"use strict";t.r(a);var n=t(31),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("blockquote",[t("p",[s._v("本文主要介绍：\n如何从零开始使用 Jpom 中的本地构建+节点项目管理+脚本管理实现自定义管理 Python 项目（自定义启动项目，停止，查状态）")]),s._v(" "),t("p",[s._v("本文中服务端和插件端是安装在同一个服务器中的，实际操作时根据业务情况来安装")]),s._v(" "),t("p",[s._v("文中使用到的依赖环境版本仅供参考，实际使用中请根据业务情况来安装对应的版本")])]),s._v(" "),t("blockquote",[t("p",[s._v("注意：本文采用一键安装同时基于 2.8.8 版本讲解,系统为 ubuntu\n系统自带 python 环境不需要单独安装，教程中系统 python 版本 2.7.17")])]),s._v(" "),t("h2",{attrs:{id:"需要准备的环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#需要准备的环境"}},[s._v("#")]),s._v(" 需要准备的环境")]),s._v(" "),t("ol",[t("li",[s._v("Jpom 服务端、Jpom 插件端（安装 jpom 需要 java 环境）")])]),s._v(" "),t("h2",{attrs:{id:"安装服务端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装服务端"}},[s._v("#")]),s._v(" 安装服务端")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 提前创建好文件夹 并且切换到对应到文件夹执行命令\nmkdir -p /home/jpom/server/\napt install -y wget && wget -O install.sh https://dromara.gitee.io/jpom/docs/install.sh && bash install.sh Server jdk\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_java/install1.png",alt:"install1"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_java/install2.png",alt:"install2"}})]),s._v(" "),t("h3",{attrs:{id:"初始化服务端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化服务端"}},[s._v("#")]),s._v(" 初始化服务端")]),s._v(" "),t("h4",{attrs:{id:"添加超级管理账号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加超级管理账号"}},[s._v("#")]),s._v(" 添加超级管理账号")]),s._v(" "),t("blockquote",[t("p",[s._v("添加一个超级管理员账号，请妥善保管此账号同时请设置安全度较强的密码")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_java/inits1.png",alt:"install1"}})]),s._v(" "),t("h4",{attrs:{id:"开启账号-mfa"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启账号-mfa"}},[s._v("#")]),s._v(" 开启账号 MFA")]),s._v(" "),t("blockquote",[t("p",[s._v("为了系统安全，强烈建议超级管理员账号开启 MFA 两步验证")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_java/inits2.png",alt:"install2"}})]),s._v(" "),t("h2",{attrs:{id:"安装插件端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装插件端"}},[s._v("#")]),s._v(" 安装插件端")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 提前创建好文件夹 并且切换到对应到文件夹执行命令\nmkdir -p /home/jpom/agent/\napt install -y wget && wget -O install.sh https://dromara.gitee.io/jpom/docs/install.sh && bash install.sh Agent jdk\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_java/install-agent1.png",alt:"install1"}}),s._v(" "),t("img",{attrs:{src:"/images/tutorial/project_dsl_java/install-agent2.png",alt:"install2"}})]),s._v(" "),t("h3",{attrs:{id:"添加节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加节点"}},[s._v("#")]),s._v(" 添加节点")]),s._v(" "),t("p",[s._v("注意要填写端口号哟")]),s._v(" "),t("p",[s._v("这里的节点账号密码和超级管理员账号密码是两个都行哟")]),s._v(" "),t("p",[s._v("节点账号密码在安装启动成功后会输出到控制台，请根据输出到内容填写。如果自己修改了账号密码则填写修改后到")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_java/inita1.png",alt:"install1"}})]),s._v(" "),t("h3",{attrs:{id:"配置白名单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置白名单"}},[s._v("#")]),s._v(" 配置白名单")]),s._v(" "),t("p",[s._v("项目白名单是为了防止随意配置目录，同时也为了保护系统目录")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_java/inita2.png",alt:"install1"}})]),s._v(" "),t("h2",{attrs:{id:"创建脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建脚本"}},[s._v("#")]),s._v(" 创建脚本")]),s._v(" "),t("p",[s._v("注意："),t("code",[s._v("Ubuntu/Debian")]),s._v(" 执行脚本如果出现错误\n"),t("code",[s._v('Syntax error: "(" unexpected')]),s._v("\n代码对于标准bash而言没有错，因为 "),t("code",[s._v("Ubuntu/Debian")]),s._v(" 为了加快开机速度，用dash代替了传统的bash，是dash在捣鬼。")]),s._v(" "),t("p",[s._v("解决方法: 就是取消"),t("code",[s._v("dash")])]),s._v(" "),t("p",[s._v("执行："),t("code",[s._v("sudo dpkg-reconfigure dash")]),s._v(" 在选择项中选No，搞定了！")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/edit-script1.png",alt:"install1"}})]),s._v(" "),t("p",[s._v("脚本内容：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#!/bin/bash\nTag="Application_#{PROJECT_ID}"\nLib="#{PROJECT_PATH}"\nLog="#{PROJECT_PATH}/run.log"\necho $Tag\nRETVAL="0"\n\n# See how we were called.\nfunction start() {\n    echo  $Log \n    if [ ! -f $Log ]; then\n        touch $Log\n    fi\n   \n   cd $Lib && nohup python -m SimpleHTTPServer 8000 $Tag > $Log 2>&1 &  \n\tsleep 5\n    head -n 10 $Log\n}\n\n\nfunction stop() {\n    pid=$(ps -ef | grep -v \'grep\' | egrep $Tag| awk \'{printf $2 " "}\')\n    if [ "$pid" != "" ]; then      \n        echo -n "boot ( pid $pid) is running" \n        echo \n        echo -n $"Shutting down boot: "\n        pid=$(ps -ef | grep -v \'grep\' | egrep $Tag| awk \'{printf $2 " "}\')\n        if [ "$pid" != "" ]; then\n            echo "kill boot process"\n            kill -9 "$pid"\n        fi\n        else \n             echo "boot is stopped" \n        fi\n\n    status\n}\n\nfunction status()\n{\n    pid=$(ps -ef | grep -v \'grep\' | egrep $Tag| awk \'{printf $2 " "}\')\n    #echo "$pid"\n    if [ "$pid" != "" ]; then\n        echo "running:$pid"\n    else\n        echo "boot is stopped"\n    fi\n}\n\n# See how we were called.\nRETVAL="0"\ncase "$1" in\n    start)\n        start\n        ;;\n    stop)\n        stop\n        ;;\n    status)\n        status\n        ;;\n    *)\n      usage\n      ;;\nesac\n\nexit $RETVAL\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br")])]),t("blockquote",[t("ol",[t("li",[t("p",[s._v("脚本里面至少需要实现的三件事："),t("strong",[s._v("启动")]),s._v("、"),t("strong",[s._v("停止")]),s._v("、"),t("strong",[s._v("查状态")])])]),s._v(" "),t("li",[t("p",[s._v("查状态输出最后一行需要是 "),t("code",[s._v("running:$pid")]),s._v(" $pid 必须为数字且表示当前项目的进程 id ，如果不匹配项目则显示未运行")])])])]),s._v(" "),t("p",[s._v("提供的示例里面将使用三个行数来实现：start、stop、status")]),s._v(" "),t("p",[s._v("里面的细节这里不过多的说明，可以自由发挥（给您足够的空间）")]),s._v(" "),t("p",[s._v("脚本里面支持的变量有：#{PROJECT_ID}、#{PROJECT_NAME}、#{PROJECT_PATH}")]),s._v(" "),t("p",[s._v("如果多个项目管理方式相同，脚本模版可以重复使用奥（并非一个项目对应一个脚本模版）")]),s._v(" "),t("p",[s._v("更新脚本示例："),t("RouterLink",{attrs:{to:"/FQA/DSL.html"}},[s._v("✈️进入>>")])],1),s._v(" "),t("h2",{attrs:{id:"创建项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[s._v("#")]),s._v(" 创建项目")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/edit-project.png",alt:"install1"}})]),s._v(" "),t("p",[s._v("注意：")]),s._v(" "),t("ol",[t("li",[s._v("scriptArgs 为对应环节执行脚本传人的参数,这里可以使用空格隔空传人多个参数")]),s._v(" "),t("li",[s._v("scriptId 需要填写当前节点里面存在的脚本的 id,脚本ID 可以在编辑脚本弹窗里面查看，如下图")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/edit-script2.png",alt:"install1"}})]),s._v(" "),t("h2",{attrs:{id:"添加构建仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加构建仓库"}},[s._v("#")]),s._v(" 添加构建仓库")]),s._v(" "),t("p",[s._v("这里使用 jpom 演示的仓库中的 python")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/repo1.png",alt:"install1"}}),s._v(" "),t("img",{attrs:{src:"/images/tutorial/project_dsl_python/repo2.png",alt:"install1"}})]),s._v(" "),t("h2",{attrs:{id:"添加本地构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加本地构建"}},[s._v("#")]),s._v(" 添加本地构建")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/build1.png",alt:"install1"}})]),s._v(" "),t("p",[s._v("这里需要注意构建产物目录：是指仓库下面的相对路径")]),s._v(" "),t("p",[s._v("发布项目需要选择节点再选择项目")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/build2.png",alt:"install1"}})]),s._v(" "),t("p",[s._v("构建")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/build3.png",alt:"install1"}})]),s._v(" "),t("p",[s._v("执行构建")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/build4.png",alt:"install1"}})]),s._v(" "),t("p",[s._v("看到最后输出上传成功并重启表示项目已经发布完成")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/build5.png",alt:"install1"}})]),s._v(" "),t("h2",{attrs:{id:"查看项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看项目"}},[s._v("#")]),s._v(" 查看项目")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/tutorial/project_dsl_python/project-list.png",alt:"install1"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);