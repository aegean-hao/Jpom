(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{539:function(s,a,t){"use strict";t.r(a);var e=t(31),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_0、部署示意图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0、部署示意图"}},[s._v("#")]),s._v(" 0、部署示意图")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220614224953194.png",alt:"image-20220614224953194"}})]),s._v(" "),t("h2",{attrs:{id:"_1、安装jpom的server、agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装jpom的server、agent"}},[s._v("#")]),s._v(" 1、安装Jpom的Server、Agent")]),s._v(" "),t("blockquote",[t("p",[s._v("Server部署在公司内网服务器，能访问外网；")]),s._v(" "),t("p",[s._v("Agent部署在需要管理的服务器节点，比如A服务器需要部署Java应用就安装Agent。")])]),s._v(" "),t("p",[t("RouterLink",{attrs:{to:"/文档/01.安装使用/01.安装说明.html"}},[s._v("官网安装教程")])],1),s._v(" "),t("p",[s._v("这是安装完成后的Server端界面：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220614231722150.png",alt:"image-20220614231722150"}})]),s._v(" "),t("h2",{attrs:{id:"_2、代理服务器安装nginx并代理agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、代理服务器安装nginx并代理agent"}},[s._v("#")]),s._v(" 2、代理服务器安装Nginx并代理Agent")]),s._v(" "),t("blockquote",[t("p",[s._v("Nginx需要安装在具有公网IP，和Agent所在的服务器在同一个网络环境的服务器")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.runoob.com/linux/nginx-install-setup.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx安装教程"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("修改nginx.conf代理Agent")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个agent服务器定义一个唯一的代理规则")]),s._v("\n        location /16803 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_set_header Upgrade "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            proxy_pass http://ip:2123/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        location /168019 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_set_header Upgrade "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upgrade"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            proxy_pass http://ip:2123/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h2",{attrs:{id:"_3、在server初始化系统信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、在server初始化系统信息"}},[s._v("#")]),s._v(" 3、在Server初始化系统信息")]),s._v(" "),t("h3",{attrs:{id:"_1、根据部署环境建立对应的工作空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、根据部署环境建立对应的工作空间"}},[s._v("#")]),s._v(" 1、根据部署环境建立对应的工作空间")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220614231941889.png",alt:"image-20220614231941889"}})]),s._v(" "),t("h3",{attrs:{id:"_2、在节点管理添加节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、在节点管理添加节点"}},[s._v("#")]),s._v(" 2、在节点管理添加节点")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220614232352909.png",alt:"image-20220614232352909"}})]),s._v(" "),t("ul",[t("li",[s._v("节点地址：填Nginx代理的agent的地址")]),s._v(" "),t("li",[s._v("节点账号和密码安装Agent的时候有输出，查看路径：/agent安装目录/data/agent_authorize.json")])]),s._v(" "),t("h3",{attrs:{id:"_3、在节点下添加项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、在节点下添加项目"}},[s._v("#")]),s._v(" 3、在节点下添加项目")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615215035447.png",alt:"image-20220615215035447"}})]),s._v(" "),t("h3",{attrs:{id:"_4、进入项目上传jar包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、进入项目上传jar包"}},[s._v("#")]),s._v(" 4、进入项目上传jar包")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615215228148.png",alt:"image-20220615215228148"}})]),s._v(" "),t("h3",{attrs:{id:"_5、点击-控制台-启动项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、点击-控制台-启动项目"}},[s._v("#")]),s._v(" 5、点击“控制台”启动项目")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615215335584.png",alt:"image-20220615215335584"}})]),s._v(" "),t("blockquote",[t("p",[s._v("至此已经完成了项目部署的基本功能，以后每次只需要重新上传jar包，再进行重启操作完成部署。")])]),s._v(" "),t("h2",{attrs:{id:"_4、配置在线构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置在线构建"}},[s._v("#")]),s._v(" 4、配置在线构建")]),s._v(" "),t("h3",{attrs:{id:"_1、配置仓库地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置仓库地址"}},[s._v("#")]),s._v(" 1、配置仓库地址")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615215819628.png",alt:"image-20220615215819628"}})]),s._v(" "),t("ul",[t("li",[s._v("仓库地址：填写需要构建的项目地址")]),s._v(" "),t("li",[s._v("账号、密码：填写公司分配的SVN的账号密码")])]),s._v(" "),t("h3",{attrs:{id:"_2、填写构建规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、填写构建规则"}},[s._v("#")]),s._v(" 2、填写构建规则")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615220200670.png",alt:"image-20220615220200670"}})]),s._v(" "),t("ul",[t("li",[t("p",[s._v("构建命令：打包的mvn命令，不同的空间配特定的打包环境，通过"),t("code",[s._v("-P")]),s._v("参数指定；")])]),s._v(" "),t("li",[t("p",[t("RouterLink",{attrs:{to:"/FQA/02.ProperNoun.html#产物目录"}},[s._v("产物目录")]),s._v("：匹配打包后的文件进行发布。这里的是相对路径，相对的是根目录是"),t("code",[s._v("/yyyy/jpom-server/data/build/xxx/source")])],1)]),s._v(" "),t("li",[t("p",[s._v("发布操作：对于匹配的文件如何进行处理。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("不发布：仅仅打包，不进行其他操作，产物目录匹配到的文件会生成到")]),s._v(" "),t("p",[t("code",[s._v("/yyyy/jpom-server/data/build/xxx/history/#n/result")])]),s._v(" "),t("p",[s._v("xxx是一个随机字符串，每个构建规则会生成一个这样的特定字符串")]),s._v(" "),t("p",[s._v("n是序号，每次打包都会递增1生成目录")])]),s._v(" "),t("li",[t("p",[s._v("节点分发")])]),s._v(" "),t("li",[t("p",[s._v("项目：如果项目打包后只有一个jar包就可以直接选择这种方式")])]),s._v(" "),t("li",[t("p",[s._v("SSH：将匹配到的文件发布指定的服务器的指定目录")])]),s._v(" "),t("li",[t("p",[s._v("本地命令：自定义命令操作匹配到的文件。")]),s._v(" "),t("p",[t("code",[s._v("cp -rp #{BUILD_RESULT_FILE} /yyyy/deploy/test")]),s._v("这个就可以把打包完成的文件拷贝到指定的目录。")]),s._v(" "),t("p",[s._v("#{BUILD_RESULT_FILE}：jpom提供的环境变量，可以获取本次打包生成的匹配文件放入的目录")]),s._v(" "),t("p",[s._v("即"),t("code",[s._v("/yyyy/jpom-server/data/build/xxx/history/#n/result")])])]),s._v(" "),t("li",[t("p",[s._v("Docker镜像")])])])])]),s._v(" "),t("h3",{attrs:{id:"_3、进行构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、进行构建"}},[s._v("#")]),s._v(" 3、进行构建")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615222812949.png",alt:"image-20220615222812949"}})]),s._v(" "),t("ul",[t("li",[s._v("分支：选择构建的分支")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615222931149.png",alt:"image-20220615222931149"}})]),s._v(" "),t("p",[s._v("此时可以叉掉弹框去做其他的事情，打包将在后台进行")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615223136196.png",alt:"image-20220615223136196"}})]),s._v(" "),t("p",[s._v("在"),t("strong",[s._v("构建历史列表")]),s._v("也可以看到本次构建的进度以及历史的构建日志")]),s._v(" "),t("h2",{attrs:{id:"_5、配置脚本列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、配置脚本列表"}},[s._v("#")]),s._v(" 5、配置脚本列表")]),s._v(" "),t("p",[s._v("可以针对每个服务写一个脚本用于将打好的jar包上传到指定的服务器的指定目录")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615225311404.png",alt:"image-20220615225311404"}})]),s._v(" "),t("blockquote",[t("p",[s._v("既可以在【SSH管理-命令管理】也可以在【脚本管理-脚本列表】添加要编写的脚本。")]),s._v(" "),t("p",[s._v("两者的区别是，前者编写的脚本可以在指定的服务器上执行，但要先添加SSH信息，后者直接就在部署Jpom Server的服务器上执行命令。")])]),s._v(" "),t("h3",{attrs:{id:"_1、在ssh管理-命令管理添加脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、在ssh管理-命令管理添加脚本"}},[s._v("#")]),s._v(" 1、在SSH管理-命令管理添加脚本")]),s._v(" "),t("h4",{attrs:{id:"_1、添加ssh信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、添加ssh信息"}},[s._v("#")]),s._v(" 1、添加ssh信息")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615225707700.png",alt:"image-20220615225707700"}})]),s._v(" "),t("p",[s._v("如果发现连接添加的SSH服务器信息经常超时连接不上，需要在上面的"),t("strong",[s._v("其他配置")]),s._v("里面配置"),t("strong",[s._v("超时时间")]),s._v("，这样能保证程序不会因为在指定时间内没连上导致超时。")]),s._v(" "),t("h4",{attrs:{id:"_2、编写服务上传脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、编写服务上传脚本"}},[s._v("#")]),s._v(" 2、编写服务上传脚本")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615225925904.png",alt:"image-20220615225925904"}})]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"准备上传文件..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -C -P 应用服务器ssh端口号 -o "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ProxyJump 登录用户名@代理机器IP -p 代理机器ssh端口号'")]),s._v(" 构建生成jar的绝对路径 登录用户名@应用服务器ip:文件上传指定目录\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"上传成功！"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("blockquote",[t("p",[s._v("这里演示的是通过代理服务器上传文件到应用服务器，因为很多情况下有些服务器是没有外网ip的，如果有的话就直接scp上传。")])]),s._v(" "),t("h4",{attrs:{id:"_3、添加ssh-key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、添加ssh-key"}},[s._v("#")]),s._v(" 3、添加ssh key")]),s._v(" "),t("p",[s._v("因为scp命令拷贝时需要ssh秘钥认证，需要提前把ssh key的认证配置好。")]),s._v(" "),t("p",[s._v("如果是通过代理服务器上传文件到应用服务器，一共需要配置两处地方的ssh key认证")]),s._v(" "),t("ol",[t("li",[s._v("在构建服务器上生成的"),t("code",[s._v("id_rsa.pub")]),s._v("添加到代理服务器")]),s._v(" "),t("li",[s._v("在代理服务器上生成"),t("code",[s._v("id_rsa.pub")]),s._v("，将构建服务器和代理服务器的"),t("code",[s._v("id_rsa.pub")]),s._v("同时添加到应用服务器")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/mslagee/articles/6196601.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ssh public key认证免密码登录 "),t("OutboundLink")],1)]),s._v(" "),t("h4",{attrs:{id:"_4、测试脚本是否能顺利执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、测试脚本是否能顺利执行"}},[s._v("#")]),s._v(" 4、测试脚本是否能顺利执行")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615231441921.png",alt:"image-20220616144132593"}})]),s._v(" "),t("h3",{attrs:{id:"_2、在脚本管理-脚本列表添加脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、在脚本管理-脚本列表添加脚本"}},[s._v("#")]),s._v(" 2、在脚本管理-脚本列表添加脚本")]),s._v(" "),t("p",[s._v("和上面的方式同理，只是不用选择SSH节点。")]),s._v(" "),t("h2",{attrs:{id:"_6、配置服务告警邮件监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、配置服务告警邮件监控"}},[s._v("#")]),s._v(" 6、配置服务告警邮件监控")]),s._v(" "),t("h3",{attrs:{id:"_1、管理员配置好邮件初始信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、管理员配置好邮件初始信息"}},[s._v("#")]),s._v(" 1、管理员配置好邮件初始信息")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615231943904.png",alt:"image-20220615231943904"}})]),s._v(" "),t("h3",{attrs:{id:"_2、配置监控规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置监控规则"}},[s._v("#")]),s._v(" 2、配置监控规则")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615232111198.png",alt:"image-20220615232111198"}})]),s._v(" "),t("p",[s._v("联系人要配置了邮箱才能被选择")]),s._v(" "),t("h3",{attrs:{id:"_3、测试启停被监控的服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、测试启停被监控的服务"}},[s._v("#")]),s._v(" 3、测试启停被监控的服务")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615232431060.png",alt:"image-20220615232431060"}})]),s._v(" "),t("p",[s._v("邮件报警记录")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/simple-solution-01/pic/image-20220615232908740.png",alt:"image-20220615232908740"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);